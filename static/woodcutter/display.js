urls = ['back','back','back','curse','copper','silver','gold','estate','duchy','province','artisan','bandit','bureaucrat','cellar','chapel','council-room','festival','gardens','harbinger','laboratory','library','market','merchant','militia','mine','moat','moneylender','poacher','remodel','sentry','smithy','throne-room','vassal','village','witch','workshop','courtyard','conspirator','courtier','baron','bridge','diplomat','duke','harem','nobles','ironworks','lurker','masquerade','mill','mining-village','minion','patrol','pawn','replace','secret-passage','shanty-town','steward','swindler','torturer','trading-post','upgrade','wishing-well','ambassador','bazaar','caravan','cutpurse','embargo','explorer','fishing-village','ghost-ship','haven','island','lighthouse','lookout','merchant-ship','native-village','navigator','outpost','pearl-diver','pirate-ship','salvager','sea-hag','smugglers','tactician','treasure-map','treasury','warehouse','wharf','alchemist','apothecary','apprentice','familiar','golem','herbalist','philosophers-stone','possession','potion','scrying-pool','transmute','university','vineyard','bank','bishop','colony','contraband','counting-house','city','expand','forge','grand-market','goons','hoard','kings-court','loan','mint','monument','mountebank','peddler','platinum','quarry','rabble','royal-seal','talisman','trade-route','vault','venture','watchtower','workers-village','prize-pile','bag-of-gold','diadem','fairgrounds','farming-village','followers','fortune-teller','hamlet','harvest','horse-traders','horn-of-plenty','hunting-party','jester','menagerie','princess','remake','tournament','trusty-steed','young-witch','border-village','cache','cartographer','crossroads','develop','duchess','embassy','farmland','fools-gold','haggler','highway','ill-gotten-gains','inn','jack-of-all-trades','mandarin','noble-brigand','nomad-camp','oasis','oracle','margrave','scheme','silk-road','spice-merchant','stables','trader','tunnel','ruin-pile','knights','abandoned-mine','altar','armory','band-of-misfits','bandit-camp','beggar','catacombs','count','counterfeit','cultist','dame-anna','dame-josephine','dame-molly','dame-natalie','dame-sylvia','death-cart','feodum','forager','fortress','graverobber','hermit','hovel','hunting-grounds','ironmonger','junk-dealer','madman','market-square','marauder','mercenary','mystic','necropolis','overgrown-estate','pillage','poor-house','procession','rats','rebuild','rogue','ruined-library','ruined-market','ruined-village','sage','scavenger','sir-bailey','sir-destry','sir-martin','sir-michael','sir-vander','spoils','storeroom','squire','survivors','urchin','vagrant','wandering-minstrel','advisor','baker','butcher','candlestick-maker','doctor','herald','journeyman','masterpiece','merchant-guild','plaza','taxman','soothsayer','stonemason','alms','amulet','artificer','ball','bonfire','borrow','bridge-troll','caravan-guard','champion','coin-of-the-realm','disciple','distant-lands','dungeon','duplicate','expedition','ferry','fugitive','gear','giant','guide','haunted-woods','hero','hireling','inheritance','lost-arts','lost-city','magpie','messenger','miser','mission','pathfinding','page','peasant','pilgrimage','plan','port','quest','ranger','raid','ratcatcher','raze','relic','royal-carriage','save','scouting-party','seaway','soldier','storyteller','swamp-hag','teacher','travelling-fair','trade','training','transmogrify','treasure-trove','treasure-hunter','warrior','wine-merchant','encampment','plunder','patrician','emporium','settlers','bustling-village','catapult','rocks','gladiator','fortune','castles','humble-castle','crumbling-castle','small-castle','haunted-castle','opulent-castle','sprawling-castle','grand-castle','kings-castle','advance','annex','archive','aqueduct','arena','bandit-fort','banquet','basilica','baths','battlefield','capital','charm','chariot-race','city-quarter','colonnade','conquest','crown','delve','defiled-shrine','dominate','donate','enchantress','engineer','farmers-market','forum','fountain','groundskeeper','keep','labyrinth','legionary','mountain-pass','museum','obelisk','orchard','overlord','palace','ritual','royal-blacksmith','sacrifice','salt-the-earth','tax','temple','tomb','tower','triumph','triumphal-arch','villa','wall','wolf-den','wedding','wild-hunt','windfall','boon-drawpile','boon-discardpile','the-earths-gift','the-fields-gift','the-flames-gift','the-forests-gift','the-moons-gift','the-mountains-gift','the-rivers-gift','the-seas-gift','the-skys-gift','the-suns-gift','the-swamps-gift','the-winds-gift','hex-drawpile','hex-discardpile','bad-omens','delusion','envy','famine','fear','greed','haunting','locusts','misery','plague','poverty','war','miserable','twice-miserable','envious','deluded','lost-in-the-woods','bard','blessed-village','changeling','cemetery','cobbler','conclave','crypt','cursed-village','den-of-sin','devils-workshop','druid','exorcist','faithful-hound','fool','ghost-town','guardian','idol','leprechaun','monastery','necromancer','night-watchman','pixie','pooka','raider','sacred-grove','secret-cave','shepherd','skulk','tormentor','tragic-hero','tracker','vampire','werewolf','cursed-gold','goat','haunted-mirror','lucky-coin','magic-lamp','pasture','pouch','bat','ghost','imp','will-o-wisp','wish','zombie-apprentice','zombie-mason','zombie-spy','avanto','black-market','envoy','governor','prince','sauna','stash','summon','walled-village','black-market-pile','dismantle','back','back','acting-troupe','border-guard','cargo-ship','ducat','experiment','flag-bearer','hideout','inventor','improve','lackeys','mountain-village','patron','priest','research','silk-merchant','old-witch','recruiter','scepter','scholar','sculptor','seer','spices','swashbuckler','treasurer','villain','flag','horn','key','lantern','treasure-chest','academy','barracks','canal','capitalism','cathedral','citadel','city-gate','crop-rotation','exploration','fair','fleet','guildhall','innovation','pageant','piazza','road-network','sewers','silos','sinister-plot','star-chart']
borders = ['666666','666666','666666','b571b3','f1d14d','f1d14d','f1d14d','548c2b','548c2b','548c2b','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','9cbe8a','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','8ca2be','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','8ca2be','9cbe8a','a9c35d','aac298','c4c0b4','c4c0b4','c4c0b4','aac298','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','dda561','c4c0b4','c4c0b4','c4c0b4','dda561','c4c0b4','dda561','aac298','dda561','c4c0b4','dda561','c4c0b4','c4c0b4','dda561','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','dda561','c4c0b4','c4c0b4','c4c0b4','dda561','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','d8c280','c4c0b4','f1d14d','c4c0b4','c4c0b4','c4c0b4','9cbe8a','d8c280','c4c0b4','548c2b','d8c280','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','d8c280','c4c0b4','d8c280','c4c0b4','c4c0b4','c4c0b4','c4c0b4','f1d14d','d8c280','c4c0b4','d8c280','d8c280','c4c0b4','c4c0b4','d8c280','8ca2be','c4c0b4','666666','c4c0b4','d8c280','9cbe8a','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','8ca2be','d8c280','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','d8c280','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','9cbe8a','939e9d','c4c0b4','c4c0b4','d8c280','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','9cbe8a','c4c0b4','c4c0b4','8ca2be','879e96','b29462','c4c0b4','b29462','c4c0b4','c4c0b4','c4c0b4','c4c0b4','8ca2be','c4c0b4','c4c0b4','d8c280','c4c0b4','c4c0b4','aac298','c4c0b4','c4c0b4','c4c0b4','c4c0b4','9cbe8a','c4c0b4','c4c0b4','c4c0b4','c4c0b4','a48892','c4c0b4','c4c0b4','c4c0b4','c4c0b4','8ca2be','c4c0b4','c4c0b4','c4c0b4','d59f89','b4a65e','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','b29462','b29462','b29462','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','d8c280','c4c0b4','c4c0b4','b29462','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','d8c280','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','a9a39d','dda561','c4c0b4','a9a39d','a9a39d','a9a39d','dda561','a7a39b','dda561','c2a85c','c2bfba','9da97d','dda561','c5af85','a9a39d','a9a39d','c2bfba','dda561','c4c0b4','c5af85','dda561','c2bfba','dda561','a9a39d','a9a39d','c4c0b4','c4c0b4','c4c0b4','c4c0b4','a9a39d','a9a39d','c2bfba','c2bfba','a9a39d','a9a39d','c4c0b4','a9a39d','c4c0b4','a9a39d','c5af85','c4c0b4','d8c280','c5af85','a9a39d','a9a39d','a9a39d','c2bfba','c4c0b4','dda561','c5af85','a9a39d','a9a39d','a9a39d','c5af85','d8c280','c2bfba','c2bfba','c5af85','c4c0b4','d8c280','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','d8c280','c4c0b4','d8c280','9cbe8a','a9c35d','9cbe8a','aac298','9cbe8a','aac298','9cbe8a','9cbe8a','9cbe8a','a9a39d','a9a39d','dda561','65ab6f','65ab6f','65ab6f','a9a39d','65ab6f','65ab6f','65ab6f','d8c280','d8c280','c4c0b4','c4c0b4','65ab6f','a9a39d','cec28a','a9a39d','65ab6f','a9a39d','a9a39d','dda561','c4c0b4','c4c0b4','c4c0b4','65ab6f','c4c0b4','65ab6f','65ab6f','c4c0b4','65ab6f','65ab6f','65ab6f','65ab6f','c4c0b4','65ab6f','a9a39d','c4c0b4','c4c0b4','a9a39d','a9a39d','c4c0b4','65ab6f','65ab6f','a9a39d','65ab6f','c4c0b4','65ab6f','65ab6f','a9a39d','c4c0b4','a9a39d','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','dbcf00','4137df','4137df','4137df','4137df','4137df','4137df','4137df','4137df','4137df','4137df','4137df','4137df','4137df','4137df','ceb0a4','ceb0a4','ceb0a4','ceb0a4','ceb0a4','c4c0b4','c4c0b4','30484e','9cbe8a','7a5622','c4c0b4','7a5622','c4c0b4','7a5622','30484e','c4c0b4','30484e','8ca2be','c4c0b4','7a5622','7a5622','d8c280','c4c0b4','30484e','c4c0b4','30484e','c4c0b4','c4c0b4','7a5622','c4c0b4','dda561','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','30484e','30484e','d8c280','d8c280','d8c280','d8c280','d8c280','a9c35d','d8c280','30484e','7a5622','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','c4c0b4','d8c280','a9a39d','c4c0b4','666666','c4c0b4','c73400','c73400','5a382c','86785e','95b2be','d3bb66','725151','c0c4c4','292b23','5b4c2d','9e8f7e','826275','819369','795547','926221','614c35','965744','483830','8e8973','8c6752','52494d','3d322c','725a47','6d413e','99928b','7e5a45','3d2e31','eee1c9','85745b','7b5244','594646','93743f','9f8c74','6f797b','a89385','908691','9fa087','abac91','8d7955','888b78','87afc6','726d6f','7b5d53','675b56','c79b6d','6c7065','a59075','819794','2d2c28','8c948c','534637','b9987c']
interiors = ['666666','666666','1528b7','a2b8b8','a05624','709aa4','ffae06','bfb597','6aa09a','efaf49','bc5a00','8a861e','95633b','3e4646','605444','815121','636d61','5f792f','8e8a3c','614739','7a7e4a','684830','917911','856961','433935','586472','7a644c','8f810d','8e7e4a','5a361e','6a523a','d76315','ba6816','7e9078','52444e','8c6428','74a454','2b5989','ac6228','876341','859b6b','91595f','8a7e5e','c3510d','816155','7d3b1f','909ab2','635d51','78b294','aea090','6c382e','98ae70','3f2f25','564850','261e12','124e44','4f4d5d','b78d49','842804','686434','979773','61756b','b8602c','a6765e','b9ab7f','826a4e','9da381','74D0F6','7db9b3','59814d','866846','5d9fbd','559773','723a6a','b58127','6f919f','5ba7ad','949ab2','00aee6','7e9ec2','397b7b','745a44','464c50','785c44','9d651b','884a00','59635b','7b778f','49A4E4','a36713','ce5800','aa6656','5e6c80','b8884e','980642','736157','1768C4','a45e08','764a76','77714b','8c9652','616745','6a587c','9494d8','68442c','6f5143','a4a07c','d77b07','d05a2a','ab735b','6d6129','917d25','926634','9d936f','7a5e40','8191ab','866a6a','9a5a2e','948266','b9b59f','88422c','d8b08e','b28038','65a167','947e4e','624e36','7496c0','cd7119','666666','b47214','ffba14','9a8462','8d7f67','ab670b','884214','8e9886','cd9f49','595561','7b4d27','4e4e48','9f7967','8a7234','804e10','b46614','937755','6e726a','7b653b','758791','6e7846','a45a14','a7a187','c09864','999b77','8e725c','4fbb9d','b8a62e','a07a56','a0be8c','9d6d41','71957d','7aa2a4','b38f2d','645c46','87a1b1','8e9864','69491b','7c6c48','7f7d7d','948452','af7b4d','875d33','988a34','545258','666666','819381','633b29','7e3800','54564e','56505c','42889e','503626','472f1f','58605c','a66e28','4b4957','775f35','635147','946e50','56665a','744c36','826636','b4a67e','a46618','62524c','4e4052','977d5b','25716f','a08250','72787a','7b5f2d','8b513d','956d43','7e4826','6b8193','695729','778793','58664c','8d7f63','65573d','775f3d','795743','64748c','363c4c','806a34','6d5753','a4886a','89612f','34404e','506070','797d7f','cc9e60','47454b','9ca6ac','646032','69492f','937b4b','706a46','634b33','593f2b','905414','77675b','815b3b','9c6426','7d6137','895923','996941','78704e','d5c361','a44410','87573f','70583a','514135','915d23','9f793f','d39d25','754f2b','8b6323','844e52','8a3620','524830','7c8e68','594c3e','ae6c00','966a2c','c49e8c','4f472d','8a887c','ca8c28','798593','888095','877969','9c7c5a','486e4a','314b39','423732','745666','657759','ab4f1f','969c6c','707870','99afc3','726a60','7e767c','664820','553d33','cab026','6e4e28','6c4630','586c6e','685456','8c7236','4f4347','655d4f','6b5949','616959','9a7450','814d3b','97875b','7195a3','a58e74','ad735f','8c462e','bb7937','d2942c','735941','533f33','6e6258','95795f','494343','564543','855b31','6d4527','573E30','6a80a0','50ABDF','784624','745E4D','839f55','80963a','b28674','94794F','2d7bbb','63af7f','ceb22c','96a692','4a6064','4f9391','ffb300','9e7e5a','cd8959','714d41','7a5a36','7b5d47','9a905c','b0587c','b0a66e','6f5735','835945','746c44','528ec6','765648','756349','7f7569','7e6a30','9f7b27','7c9692','7b4b33','716149','5a746e','896b71','886c7a','a5855f','733719','867642','bc9256','7c5a34','978957','6f4f7d','5e884c','714b41','657d8d','c47a00','774d29','707c5c','9a8a90','c07442','7a5224','69452b','9b675f','7b8383','a0745a','d6b452','8b8585','bb9b3d','913d05','8f8b51','87b34f','5e4a54','a1a18f','715919','15516f','9e5402','666666','666666','6b6733','d3cd17','ff8f00','3b8d0b','001ee4','005cff','4e9c92','0071d7','1cbeff','fcbe00','39650b','67d35b','666666','666666','4d4135','65634d','618f55','919f8f','1f3347','c13f0b','344860','43c95f','1c161a','42aa6c','2e2a2a','a12700','1c161a','1c161a','618f55','65634d','527052','57932f','8f7737','183442','53735b','5a501c','9c6a14','0d494f','265ea6','2c2226','7d5b83','49b921','3763b5','8c7640','a7af3f','173b57','376db9','b13700','5e7c04','02268a','525a36','464266','a9db75','6b6700','00238b','5e7632','be741c','9caa90','7e6060','884c6a','5c88a4','87c7d9','523a4c','9f8193','7D4D22','a1e15d','4F302B','9ed654','8c3400','959D8D','4A4A55','475B5D','13b12f','936d69','1d593f','0f6551','292d23','5f513d','363438','9fa3af','b5b5b5','425064','8f9989','a4863c','9f8d7b','c5ba99','c19b59','6eaa70','666666','8DAEB6','A02900','A02900','5a382c','86785e','95b2be','d3bb66','725151','c0c4c4','292b23','5b4c2d','9e8f7e','826275','819369','795547','926221','614c35','965744','483830','8e8973','8c6752','52494d','3d322c','725a47','6d413e','99928b','7e5a45','3d2e31','eee1c9','85745b','7b5244','594646','93743f','9f8c74','6f797b','a89385','908691','9fa087','abac91','8d7955','888b78','87afc6','726d6f','7b5d53','675b56','c79b6d','6c7065','a59075','819794','2d2c28','8c948c','534637','b9987c']

class Card extends React.Component {
    divStyle() {
        return {backgroundImage: 'url(' + staticRoot + '/card_images/' + urls[this.props.index] + '-mid.jpg)'}
    }

    borderStyle() {
        return {background: '#' + borders[this.props.index]}
    }

    render() {
        return (
            <div className='card-container'>
                <div className='card-label'>
                    {this.props.amount}
                </div>
                <div className='card-small' style={this.borderStyle()}>
                    <div className='card-small-inner' style={this.divStyle()}>
                    </div>
                </div>
            </div>
        );
    }
}


class CardStack extends React.Component {
    cardList(){
        return this.props.cards.split('+').map(c => c.split(':'));
    }

    render() {
        var output = '';
        if (this.props.cards){
            var output = this.cardList().map((n, i) => <Card amount={parseInt(n[0])} index={parseInt(n[1], 16)} key={i}/>);
        }
        var className = 'card-stack ' + this.props.classes;
        return <div className={className}>
            {output}
        </div>
    }
}


class Board extends React.Component {
    render(){
        var boardString = boards.split('~')[this.props.index + 1];
        var cardStacks = boardString.split('|');
        var inPlays = (cardStacks[4] ? cardStacks[4] : cardStacks[5]);
        return(
            <div className='board'>
                <div style={{'position': 'absolute'}}>{this.props.index}</div>
                <CardStack cards={cardStacks[0]} classes='decks top' />
                <CardStack cards={cardStacks[1]} classes='decks bot' />
                <CardStack cards={cardStacks[2]} classes='hands top' />
                <CardStack cards={cardStacks[3]} classes='hands bot' />
                <CardStack cards={inPlays} classes='inplays' />
                <CardStack cards={cardStacks[6]} classes='discards top' />
                <CardStack cards={cardStacks[7]} classes='discards bot' />
                <CardStack cards={cardStacks[8]} classes='tavern top' />
                <CardStack cards={cardStacks[9]} classes='tavern bot' />
                <CardStack cards={cardStacks[10]} classes='others top' />
                <CardStack cards={cardStacks[11]} classes='others bot' />
                <CardStack cards={cardStacks[12]} classes='supply' />
                <CardStack cards={cardStacks[13]} classes='trash' />
            </div>
        );
    }
}


class StoryLabel extends React.Component{
    isDark(){
        var color = interiors[this.props.index];
        var sum = 0;
        for (var i = 0; i < 5; i += 2){
            sum += parseInt(color.slice(i, i + 2), 16);
        }
        return sum < 384;
    }

    render(){
        var style = {
                     'background': '#' + interiors[this.props.index],
                     'borderColor': '#' + borders[this.props.index],
                     'color': '#' + (this.isDark() ? 'FFF' : '000')
                    };
        return <div className='story-label' style={style}> {this.props.text} </div>;
    }
}


class StoryLine extends React.Component {
    constructor(props){
        super(props);
        this.clickEvent = this.clickEvent.bind(this);
    }
    clickEvent(){
        this.props.changeIndex(this.props.num);
    }
    render(){
        var indent = this.props.line.split('>')[0];
        indent = (parseInt(indent) < 7 ? parseInt(indent) : 7);
        var style = {'width': (90 - indent * 5).toString() + '%'};
        var raw = this.props.line.split('>')[1].split('|');
        var output = [raw.shift()];
        var i = 0;
        while (raw.length > 0){
            output.push(<StoryLabel text={raw.shift()} index={raw.shift()} key={i} />);
            output.push(raw.shift());
            i++ ;
        }
        return(
            <div className='story-line' style={style} onClick={this.clickEvent}>
                {output}
            </div>
        );
    }
}


class Story extends React.Component {
    render(){
        var lines = story.split('~').map((x, n) => <StoryLine line={x} key={n} num={n} changeIndex={this.props.changeIndex}/>);
        return <div className='story'>
            {lines}
        </div>;
    }
}


class Container extends React.Component{
    constructor(props) {
        super(props);
        this.state = {index: 0};
        this.changeIndex=this.changeIndex.bind(this);
    }
    changeIndex(i){
        this.setState({index: i});
    }
    render(){
        return (<div className='content'>
            <div className='title-container'>{title}</div>
            <div className='board-container'>
                <Board index={this.state.index}/>
            </div>
            <div className='base-container' />
            <div className='story-container'>
                <Story changeIndex={this.changeIndex}/>
            </div>
        </div>
        );
    }
}

const mainContainer = document.querySelector('.main-container');
ReactDOM.render(<Container />, mainContainer);